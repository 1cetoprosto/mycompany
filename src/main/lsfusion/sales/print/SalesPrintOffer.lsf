MODULE SalesPrintOffer;

REQUIRE  SalesOrder, SalesOrderStatus, SalesOrderStatusSent, SalesOrderStatusDraft, Partner, SalesPrintData;

NAMESPACE Purchase;
 
FORM printRequest 'Запрос поставщику'   
    OBJECTS o = Order PANEL 
    PROPERTIES(o) sentRequestDateTime, commintmentDate, number, nameLocation, fullAddressLocation, nameCustomer, fullAddressVendor, phoneVendor, nameCompany, fullAddressCompany, phoneCompany
        
    OBJECTS l = OrderLine
    PROPERTIES(l) nameItem, description, quantity
    FILTERS order(l) = o
; 
    
printRequest 'Печать запрос' (Order o) {
    sentRequestDateTime(o) <- currentDateTime();
    sent(o) <- TRUE;
    PRINT printRequest OBJECTS o = o;
    MESSAGE 'Запрос напечатан';    
    MESSAGE fullAddressCompany(o);
}  

reprintRequest 'Печать запрос' (Order o) {
    PRINT printRequest OBJECTS o = o;   
    MESSAGE 'Запрос напечатан';    
}  
 
EXTEND FORM order
     PROPERTIES(o) SHOWIF (status(o)=OrderStatus.draft)  printRequest BACKGROUND (CASE WHEN NOT sent(o) THEN nextAction())
     PROPERTIES(o) SHOWIF (status(o)=OrderStatus.offerSent)  reprintRequest
;

DESIGN order {
    statusPane {
        statusActions {
            MOVE PROPERTY(printRequest(o)) FIRST;             
            MOVE PROPERTY(reprintRequest(o));             
        }
    }
}

